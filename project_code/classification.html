
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Magnetic - Stunning Responsive HTML5/CSS3 Photography Template</title>
	<meta charset="utf-8">
	<meta name="author" content="pixelhint.com">
	<meta name="description" content="Magnetic is a stunning responsive HTML5/CSS3 photography/portfolio website  template"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
	<link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <style>
    #number {
		float:left;
	}
	#classifications {
		float: left;
	}
	#continents { 
		float: left;
	}

	.domain {
	  opacity:0;
	}

	.axis path,
	.axis line {
	  fill: none;
	  stroke: none;
	}

	.bar {
	  fill: steelblue;
	}

	.x.axis path {
	  display: none;
	}


	.legend line {
	  stroke: #000;
	  shape-rendering: crispEdges;
	}
    </style>
</head>
<body>



	<section class="main clearfix">

		<section class="top">	
			<div class="wrapper content_header clearfix">
				<div class="work_nav">
							
					<ul class="btn clearfix">
						<li><a href="#" class="previous" data-title="Previous"></a></li>
						<li><a href="index.html" class="grid" data-title="Portfolio"></a></li>
						<li><a href="#" class="next" data-title="Next"></a></li>
					</ul>							
					
				</div><!-- end work_nav -->
				<h1 class="title">Uncovering Secrets: Visualizing Wikileaks</h1>
			</div>		
		</section><!-- end top -->

		<section class="wrapper">
			<div class="content">
			<div id="prototype">
				<h1>State Department Cables By Classification Status: 2000-2010</h1>
				<svg id="classifications"></svg>
				<svg id="right"></svg>
			</div>


			</div><!-- end content -->
		</section>
	</section><!-- end main -->
	
	<script>
var vert_margin = {top: 25, right: 15, bottom: 25, left: 45},
    vert_width = 400 - vert_margin.left - vert_margin.right,
    vert_height = 600 - vert_margin.top - vert_margin.bottom;


var hor_margin = {top: 25, right: 50, bottom: 25, left: 45},
    hor_width = 600 - hor_margin.left - hor_margin.right,
    hor_height = 600 - hor_margin.top - hor_margin.bottom;


var x = d3.scale.ordinal()
    .rangeBands([0, vert_width], .1);

var y = d3.scale.linear()
    .range([vert_height, 0]);


var commaFormat = d3.format("0,000");

var color = d3.scale.ordinal()
	.domain(['secret', 'confidential', 'unclassified', 'unknown'])
    .range(["#e41a1c", "#a6cee3", "#b2df8a", "#bdbdbd"]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");
    // .tickFormat(d3.format(".0%"));

var svg = d3.select("#classifications")
    .attr("width", vert_width + vert_margin.left + vert_margin.right)
    .attr("height", vert_height + vert_margin.top + vert_margin.bottom)
  .append("g")
    .attr("transform", "translate(" + vert_margin.left + "," + vert_margin.top + ")");

var rightSvg = d3.select("#right")
	    .attr("width", hor_width + hor_margin.left + hor_margin.right + 22)
	    .attr("height", hor_height + hor_margin.top + hor_margin.bottom);

var classHeight = 250; 
var classY  = d3.scale.ordinal()
	.domain([""])
    .rangeBands([classHeight, 0], .5);

var classX = d3.scale.linear()
    .range([0, hor_width]);

var classYAxis = d3.svg.axis()
    .scale(classY)
    .orient("right");

var continentColor = d3.scale.ordinal()
		.domain(["Africa", "Latin America", "North America", "Northwest Asia", "Northwest Europe", "Southeast Asia & Pacific", "Southeast Europe"])
		.range(['rgb(141,211,199)','rgb(255,255,179)','rgb(190,186,218)','rgb(251,128,114)','rgb(128,177,211)','rgb(253,180,98)','rgb(179,222,105)']);

var continentX = {
	"secret": d3.scale.linear().range([0, hor_width]), 
	"confidential": d3.scale.linear().range([0, hor_width]), 
	"unclassified": d3.scale.linear().range([0, hor_width]), 
}
var alreadyDrawn = false; 

d3.json("data/updatedClassCounts.json", function(error, data) {

		function draw_classifications(yr){
			year_data = data.filter(function(d) {return d.year == yr})[0].continentData;
			console.log(year_data[0]);

			year_data.forEach(function(d) {
   			var x0 = 0;
    		d.contentValues = ["Africa", "Latin America", "North America", "Northwest Asia", "Northwest Europe", "Southeast Asia & Pacific", "Southeast Europe"].map(function(cont) { 
		    			if (isNaN(+d['continents'][cont])){
		    				barWidth = 0;
		    			}
		    			else {
		    				barWidth = +d['continents'][cont];
		    			}
		    	if (cont == "Southeast Europe"){
		    		continentX[d['classification']].domain([0, 1]);
		    	};
    			return {name: cont, classif: d['classification'], x0: x0, x1: x0 += barWidth }; });
    		d.contentValues.forEach(function(d) { d.x0 /= x0; d.x1 /= x0; });

    		console.log(d.contentValues);
 			 });

			if (alreadyDrawn){
				rightSvg.select(".continentBars").remove(); 
				// rightSvg.select(".legend").remove();
			} else {
				alreadyDrawn = true; 
			}
			var classificationGroup = rightSvg.append("g").attr("class", "continentBars"); 
			var legend = rightSvg.append("svg").attr("class", "legend");

			var classificationBars = classificationGroup.selectAll('.classifications')
			.data(year_data)
		    .enter().append("g")
		      .attr("class", "classifications")
		      .attr("transform", function(d) { return "translate(0," + (300 + classY(d.classification)) + ")"; });


		    classificationBars.selectAll("rect")
		    .data(function(d){return d.contentValues})
		    .enter().append("rect")
		      .attr("height", classY.rangeBand())
		      .attr("x", function(d) { 
		      	console.log(d.classif)
		      	scale = continentX[d.classif];
		      	return scale(d.x0); })
		      .attr("width", function(d) { 
		      	scale = continentX[d.classif];
		      	return scale(d.x1) - scale(d.x0); })
		      .style("fill", function(d){
		      	return continentColor(d.name);
		      });

		  	classificationGroup.append("g")
      		.attr("class", "cont_y axis")
      		.attr("transform", "translate(" + (hor_width + 5) + ",300)")
      		.call(classYAxis)
      		.style("font-size", 15);

			toplevels = ["Government","Sociology", "Geography", "Economics",  "Military"];

			// var legend = d3.select("#treemap-legend")
			//               .style("margin-left", "15%")
			//               .style("padding-top", "3%")
			//               .style("margin-bottom", 0)
			//               .append("svg")
			//               .attr("width", 700)
			//               .attr("height", 40);


			// yscale = d3.scale.linear().domain([0, 5]).range([0, 700])

			// console.log(tree_color.domain())
			// legend.selectAll("text")
			//       .data(toplevels)
			//       .enter()
			//       .append("text")
			//       .attr("x", function(d, i){return yscale(i)})
			//       .attr("y", 20)
			//       .attr("fill", function(d){ return tree_color(d)})
			//       .style("font-size", 20)
			//       .style("font-family", "Georgia, serif")
			//       .text(function(d){return d});

		};


		classY.domain(['secret', 'confidential', 'unclassified']);
		
		yearArray = data.map(function(d){return d.year}).sort();
		x.domain(yearArray);

		// delete this. return to percentages. return to linear scale 
		y.domain([0, d3.max(data, function(d){return +d.nCables})]);
		console.log(y.domain());
		console.log(y(50));

		data.forEach(function(d) {
   			var y0 = 0;
    		d.classifications = color.domain().map(function(status) { return {name: status, 
    																			y0: y0, 
    																			y1: y0 += +d['stackedData'][status]}; });
 			 });

		var yearHighlight = false; 
		console.log(data); 
		svg.append("g")
      		.attr("class", "x axis")
      		.attr("transform", "translate(0," + vert_height + ")")
      		.call(xAxis)
      		.style("font-size", 12);
  		svg.append("g")
      		.attr("class", "y axis")
      		.call(yAxis)
      		.style("font-size", 12);

      	var years = svg.selectAll(".years")
      		.data(data)
		    .enter().append("g")
		      .attr("class", "years")
		      .attr("transform", function(d) { return "translate(" + x(d.year) + ",0)"; })
		      .on("click", function(d){
		      		if (yearHighlight){
		      		yearHighlight = false; 
		      		d3.selectAll(".years")
		      		.transition().duration(200).style("opacity", 1);
		 			

		      	} else {
		      		console.log(d);
		      		yearHighlight = true; 
		      		d3.selectAll(".years")
		      		.filter(function(otherD){ return otherD.year != d.year})
		      		.transition().duration(200).style("opacity", .15);

		      		draw_classifications(d.year);
		      		d3.select("#yearText").select("text").remove(); 
		      		d3.select("#yearText")
		      			.append("text")
		      			.text(d.year + ": ")
		      				.style("stroke", "#bdbdbd")
	    					.style("fill", "#bdbdbd")
	    					.style("font-size", 15);

	    			d3.select("#numberText").select("text").remove(); 
		      		d3.select("#numberText")
		      			.append("text")
		      			.text(commaFormat(d.nCables))
		      				.style("stroke", "black")
						    .style("fill", "black")
						    .style("font-size", 50);


		      	}
		      });

		console.log(data[0]);


		years.selectAll("rect")
	      .data(function(d) { return d.classifications; })
	    .enter().append("rect")
	      .attr("width", x.rangeBand())
	      .attr("y", function(d) { return y(d.y1); })
	      .attr("height", function(d) { return y(d.y0) - y(d.y1); })
	      .style("fill", function(d) { return color(d.name); });

	    var sumCables = d3.sum(data, 
	    	function(d){return d.stackedData.unclassified + d.stackedData.secret + d.stackedData.unknown + d.stackedData.confidential});

	    console.log(sumCables); 

	     

	    rightSvg.append("g")
	    .attr("id", "yearText")
	    .attr("transform", "translate(0,92)")
	    .append("text")
	    .text("All Years: ")
	    .style("stroke", "#bdbdbd")
	    .style("fill", "#bdbdbd")
	    .style("font-size", 15);

	    rightSvg.append("g")
	    .attr("id", "numberText")
	    .attr("transform", "translate(70,92)")
	    .append("text")
	    .text(commaFormat(Math.round(sumCables)))
	    .style("stroke", "black")
	    .style("fill", "black")
	    .style("font-size", 50);


	    rightSvg.append("g")
	    .attr("class", "staticText")
	    .attr("transform", "translate(250,92)")
	    .append("text")
	    .text("cables")
	    .style("stroke", "#bdbdbd")
	    .style("fill", "#bdbdbd")
	    .style("font-size", 15);

	    rightSvg.append("g")
	    .attr("class", "numberText")
	    .attr("transform", "translate(0,270)")
	    .append("text")
	    .text("Cable Density By Region, Divided By Status")
	    .style("stroke", "#bdbdbd")
	    .style("fill", "#bdbdbd")
	    .style("font-size", 19);

	    

	    
	    draw_classifications("2001");

	    //



	});
	</script>
</body>
</html>