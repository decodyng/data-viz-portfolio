<!DOCTYPE html>
<html lang="en">
<head>
	<title>Census Exploration</title>
	<meta charset="utf-8">
	<meta name="author" content="pixelhint.com">
	<meta name="description" content="Magnetic is a stunning responsive HTML5/CSS3 photography/portfolio website  template"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
	<link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <style>
    	
/*		.chart rect {
			fill:rgb(178, 152, 216);
		}*/

		.chart text {
			  fill: white;
			  font-family: "raleway-regular", arial;
			  text-anchor: end;
			  font-size: 20px;
			}
		.axis text {
		  font: 14px "raleway-regular", arial;
		  fill: black;
		  
		}
		.tile {
			  shape-rendering: crispEdges;
			}

		.top {
			background: url('img/rwb.jpg') no-repeat;
		}
		.axis path,
		.axis line {
		  fill: none;
		  stroke: #000;
		  shape-rendering: crispEdges;
		}

		.label {
		  font-weight: bold;
		}

		.smAx text{ font-family: sans-serif; font-size: 10px; }
		.smChart {
		  float: left;
		  padding-right: 5px;
		  padding-bottom: 5px;
		  padding-top:0;
		  padding-left:0;
		}
		.smBackground {
		  fill: white;
		}
		.smallmult {
			background: white;
			  width: 800px;
			  height: 700px;
			  margin-left:8%;
		}

		.content h2 {
			font-family: "raleway", arial;
			text-align: center;
			font-size: 35px;
			margin-bottom: 5px;
		}

		.content h4 {
			text-align:center;
			font-size:20px;
			font-weight: normal;
			color:gray;
		}
		hr {
			margin: .25em 0;
		}
/*		.y text {
			opacity:0.1;
		}
		.y path, .y line {
			opacity: 0.1;
		}*/

    </style>
</head>
<body>

	<header>
		<div class="logo">
			<a href="index.html"><img src="img/logo.png" title="Magnetic" alt="Magnetic"/></a>
		</div><!-- end logo -->

		<!--<div id="menu_icon"></div>
		<nav>
			<ul>
				<li><a href="index.html" class="selected">Home</a></li>
				<li><a href="#">About</a></li>
				<li><a href="#">The Team</a></li>
				<li><a href="#">Journal</a></li>
				<li><a href="contact.html">Contact Us</a></li>
			</ul>
		</nav>end navigation menu -->

		<div> 
			<h5 style="text-align:center; line-height:160%">This site is a repository for projects completed as part of MSAN's Information Visualization course</h5><h6 style="text-align:center">Code available at https://github.com/decodyng/data-viz-portfolio</h6>
		</div>
 
		<div class="footer clearfix">
			<ul class="social clearfix">
				<li><a href="http://decodyng.com/" target="_blank" class="website" data-title="Website"></a></li>
				<li><a href="https://twitter.com/decodyng" target="_blank" class="twitter" data-title="Twitter"></a></li>
				<li><a href="mailto:cody.marie.wild@gmail.com" target="_blank" class="email" data-title="Email"></a></li>
				<li><a href="#" target="_blank" class="mobile" data-title="814.414.7199"></a></li>
				<!--<li><a href="#" class="twitter" data-title="Twitter"></a></li>
				<li><a href="#" class="dribble" data-title="Dribble"></a></li>-->
				<!--<li><a href="#" class="rss" data-title="RSS"></a></li>-->
			</ul><!-- end social -->

			<div class="rights">
				<!--<p>Copyright Â© 2014 magnetic.</p>-->
				<p style="font-size:7px; text-align:center;">Template by <a href="">Pixelhint.com</a></p>
			</div><!-- end rights -->
		</div ><!-- end footer -->
	</header><!-- end header -->

	<section class="main clearfix">

		<section class="top">	
			<div class="wrapper content_header clearfix">
				<div class="work_nav">
							
					<ul class="btn clearfix">
						<li><a href="#" class="previous" data-title="Previous"></a></li>
						<li><a href="index.html" class="grid" data-title="Portfolio"></a></li>
						<li><a href="#" class="next" data-title="Next"></a></li>
					</ul>							
					
				</div><!-- end work_nav -->
				<h1 class="title">Census Exploration</h1>


			</div>		
		</section><!-- end top -->

		<section class="wrapper">
			<div class="content">
				<h2 class="plotTitle">Murders Per 100,000</h2>
				<h4 class="plotSubtitle">By Region and State Population</h4>
				<svg class="heatmap"></svg>
				<hr>
				<hr>
				<h2 class="plotTitle">Population vs Illiteracy Rates: By Region</h2>
				<div class="smallmult"></div>
			</div><!-- end content -->
		</section>
	</section><!-- end main -->
	<script>
	var margin = {top: 20, right: 90, bottom: 30, left: 90};
    var width = 750 - margin.left - margin.right;
    var height = 400 - margin.top - margin.bottom;

    var HMx = d3.scale.ordinal().rangeBands([0, width]);
    var HMy = d3.scale.ordinal().rangeBands([height, 0]);
    var HMz = d3.scale.linear().range(["#FFEBEB", "red"]);

    var HMxStep = 800;
    var HMyStep = 200;

    var smallWidth = 300; 
    var smallHeight = 240; 
    var smallRad = 5;
    var smMargin = {top: 15, right: 10, bottom: 40, left: 35};
    var hmSvg = d3.select(".heatmap")
    			.attr("width", width + margin.left + margin.right)
    			.attr("height", height + margin.top + margin.bottom)
    			.style("margin-left", "4%")
    			.append("g")
    				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");




    
    d3.json("state77.json", function(data){
    	data.forEach(function(d){
    		d.roundPop = d3.round(d.Population, -3);
    	});
    	var hmData = d3.nest()
    	 				.key(function(d) {return d.Region;})
    	 				.key(function(d) {return d.roundPop;})
    	 				.rollup(function(d){
    	 					return d3.mean(d, function(g) {return g.Murder})
    	 				})
    	 				.entries(data);

    	
    	HMz.domain(d3.extent(data, function(d) {return d.Murder}));
    	var populationBuckets = d3.range(0, 22000, 1000); 
    	HMy.domain(populationBuckets)
    	var hmBucketData = [];
    	var regionObjects = d3.keys(hmData);
    	var regions = [];
    	regionObjects.forEach(function(r){
    		var regionEl = hmData[r];
    		var region = regionEl["key"];
    		regions.push(region);
    		var regionDict= new Object();
    		regionEl["values"].forEach(function(exP){
    			regionDict[exP["key"]] = exP["values"];
    		}); 

    		populationBuckets.forEach(function(p){
    			if(p in regionDict){
    				var el = {region: region, population: p, murder: regionDict[p]};
    			} else {
    				var el = {region: region, population: p, murder: "NA"};	
    			}
    			hmBucketData.push(el);
    		});
    	});

    	HMx.domain(regions);
    	// var heatmap = hmSvg.selectAll("g")
				 //    .data(hmBucketData)
				 //  	.enter()
				 //  	.append("g")
				 //    	.attr("transform", function(d, i) { return "translate(" + HMx(d.region) + ", 0)"; });

    	hmSvg.selectAll(".tile")
		   .data(hmBucketData)
		    .enter().append("rect")
	      .attr("class", "tile")
	      .attr("x", function(d) { return HMx(d.region); })
	      .attr("y", function(d) { return HMy(d.population); })
	      .attr("width", HMx.rangeBand())
	      .attr("height",  HMy.rangeBand())
	      .style("fill", function(d) { 
	      			if(d.murder ==="NA"){
	      				return "#FFFFFF";
	      				// return "#696464";

	      			} else {
	      				return HMz(d.murder); 
	      			}
			      	
				      });

		var legend = hmSvg.selectAll(".legend")
		      .data(HMz.ticks(6).slice(1).reverse())
		    .enter().append("g")
		      .attr("class", "legend")
		      .attr("transform", function(d, i) { return "translate(" + (width + 20) + "," + (20 + i * 20) + ")"; });

		legend.append("rect")
	    	.attr("width", 20)
	      	.attr("height", 20)
	      	.style("fill", function(d){return HMz(d)});

	  	legend.append("text")
	      .attr("x", 26)
	      .attr("y", 10)
	      .attr("dy", ".35em")
	      .text(function(d, i){return d3.round(d, 3)});


	  	hmSvg.append("text")
	      .attr("class", "label")
	      .attr("x", width + 2)
	      .attr("y", 10)
	      .attr("dy", ".35em")
	      .text("Murder Rate");

	    hmSvg.append("g")
	      .attr("class", "x axis")
	      .attr("transform", "translate(0," + (height) + ")")
	      .call(d3.svg.axis().scale(HMx).ticks(4).orient("bottom"));
	    // .append("text")
	    //   .attr("class", "label")
	    //   .attr("x", width)
	    //   .attr("y", -6)
	    //   .attr("text-anchor", "end")
	    //   .text("Region");

	  // Add a y-axis with label.
	  hmSvg.append("g")
	      .attr("class", "y axis")
	      .call(d3.svg.axis().scale(HMy).ticks(10).orient("left"));

	    // .append("text")
	    //   .attr("class", "label")
	    //   .attr("y", 6)
	    //   .attr("dy", ".71em")
	    //   .attr("text-anchor", "end")
	    //   .attr("transform", "rotate(-90)")
	    //   .text("Population");
	    divisions = ["East South Central", "South Atlantic", "West South Central", "Pacific", "Mountain", "New England",
	    "Middle Atlantic", "East North Central", "West North Central"];
	    smData = d3.nest()
	    			.key(function(d) {return d.Region})
	    			.entries(data);

	    console.log(smData);

	    smX = d3.scale.linear().domain(d3.extent(data, function(d) {return d.Population/1000})).range([0.05*smallWidth,smallWidth*0.95]);
		smY = d3.scale.linear().domain(d3.extent(data, function(d) {return d.Illiteracy})).range([0.95*smallHeight,0.05*smallHeight]);
		smZ = d3.scale.ordinal().domain(divisions).range(['rgb(141,211,199)','rgb(255,255,179)','rgb(190,186,218)','rgb(251,128,114)','rgb(128,177,211)','rgb(253,180,98)','rgb(179,222,105)','rgb(252,205,229)','rgb(217,217,217)']); 

	   	
	    smDiv = d3.select(".smallmult");
	    smChart = smDiv.selectAll(".smChart").data(smData);
	    smChart.enter().append("div").attr("class", "smChart")
      			.append("svg").append("g");

      	smallSvgs = smDiv.select("svg")
	      .attr("width", smallWidth + smMargin.left + smMargin.right)
	      .attr("height", smallHeight + smMargin.top + smMargin.bottom);

      	g = smallSvgs.select("g")
      		.attr("transform", "translate(" + (smMargin.left) + "," + (smMargin.top) + ")");

      	g.append("rect")
	      .attr("class", "smBackground")
	      .style("pointer-events", "all")
	      .attr("width", smallWidth + smMargin.right )
	      .attr("height", smallHeight);

	    scatter = g.append("g");
	    circles = scatter.selectAll(".point")
	    .data(function(c) {return c.values})
	    .enter()
	    .append('circle');

	    circles.attr("cx", function(d) {return smX(d.Population/1000)})
	    .attr("cy", function(d) {return smY(d.Illiteracy)})
	    .attr("r", smallRad)
	    .attr("fill", function(d) {return smZ(d.Division)});

	    scatter.append("text")
			  .attr("class", "title")
			  .attr("text-anchor", "middle")
			  .attr("y", smallHeight + 14)
			  .attr("dy", smMargin.bottom / 2 + 5)
			  .attr("x", smallWidth / 2)
			  .text(function(c) {return c.key})
			  .style("font-size", 18);

		scatter.append("g")
	      .attr("class", "x axis smAx")
	      .attr("transform", "translate(0," + (smallHeight) + ")")
	      .call(d3.svg.axis().scale(smX).ticks(4).orient("bottom"))
		      .append("text")
		      .attr("class", "label")
		      .attr("x", smallWidth)
		      .attr("y", -6)

		      .text("Population (100,000s)")
		      .style("font-size", 10);

	    scatter.append("g")
	      .attr("class", "y axis smAx")
	      .call(d3.svg.axis().scale(smY).ticks(5).orient("left"));

	      
	    //add hovers on scatter plot 
	    //.rollup(function(d){return {graduation:d.HSGrad, income:d.Income}})
	 //    var smLegend = smDiv.selectAll(".legend")
		//       .data(smZ.ticks())
		//     .enter().append("g")
		//       .attr("class", "legend")
		//       .attr("transform", function(d, i) { return "translate(" + (850) + "," + (20 + i * 20) + ")"; });

		// smLegend.append("circle")
	 //    	.attr("reset", 20)
	 //      	.style("fill", function(d){return HMz(d)});
	    });

		var smLegend = d3.select(".smLegend").selectAll(".legend")
		  .data(smZ.domain())
		.enter().append("text")
		.style("display", "block")
		.text(function(d) {return d})
		.style("color", function(d){return smZ(d)});
		
		

	  	// legend.append("text")
	   //    .attr("x", 26)
	   //    .attr("y", 10)
	   //    .attr("dy", ".35em")
	   //    .text(function(d, i){return d3.round(d, 3)});


	  	// hmSvg.append("text")
	   //    .attr("class", "label")
	   //    .attr("x", width + 2)
	   //    .attr("y", 10)
	   //    .attr("dy", ".35em")
	   //    .text("Murder Rate");

			

			</script>
</body>
</html>